
{% import '_partials/_ui.html' as ui %}

{# Form Modals - Specific Ones #}

{% macro metric_entry_modal(id='daily_metrics-entry-dashboard', title='Add Metric', entry_date=None) %}
  {% call ui.modal('metrics', 'daily_metrics', id, title) %}
      {# Entry date outside tabs, only required field #}
      <div class="form-group entry-date-field">
        <label for="entry_date">Entry Date:</label>
        <input type="date" id="entry_date" name="entry_date" required
                {% if entry_date %}value="{{ entry_date }}"{% endif %}
        >
      </div>
      <div class="tab-group">
        <button type="button" role="tab" data-tab="steps" class="tab">{{ ui.steps_svg() }} Steps</button>
        <button type="button" role="tab" data-tab="weight" class="tab">{{ ui.scale_svg() }} Weight</button>
        <button type="button" role="tab" data-tab="sleep" class="tab">{{ ui.sleep_svg() }} Sleep</button>
        <button type="button" role="tab" data-tab="calories" class="tab">{{ ui.calories_svg() }} Calories</button>
      </div>

      <div role="tabpanel" class="tab-content" id="tab-steps">
          <label for="steps">Steps:</label>
          <input type="text" inputmode="numeric" data-type-int id="steps" name="steps">
          <small class="error-inline"></small>
      </div>
      <div role="tabpanel" class="tab-content field-pair field-pair--weighted" id="tab-weight" hidden>
          <div>
              <label for="weight">Weight:</label>
              <input type="text" inputmode="decimal" data-type-float data-step="0.1" id="weight" name="weight">
              <small class="error-inline"></small>
          </div>
          <div>
              <label for="weight_units">Units:</label>
              <select name="weight_units" id="weight_units">
                <option value="kg" {{ 'selected' if current_user.units.value == 'metric' }}>kg</option>
                <option value="lbs" {{ 'selected' if current_user.units.value == 'imperial' }}>lbs</option>
              </select>
              <!-- To stabilize grid cell height in this field-pair -->
              <small class="error-inline-UNUSED"></small>
          </div>
      </div>
      <div role="tabpanel" class="tab-content" id="tab-calories" hidden>
          <label for="calories">Calories:</label>
          <input type="text" inputmode="numeric" data-type-int id="calories" name="calories">
          <small class="error-inline"></small>
      </div>
      <div role="tabpanel" class="tab-content" id="tab-sleep" hidden>
        <div>
          <label for="wake_datetime">Wake Time:</label>
          <input type="datetime-local" id="wake_datetime" name="wake_datetime"
            {% if entry_date %}value="{{entry_date}}T00:00"{% endif %}>
          <small class="error-inline"></small>
        </div>
        <div>
          <label for="sleep_datetime">Sleep Time:</label>
          <input type="datetime-local" id="sleep_datetime" name="sleep_datetime"
            {% if entry_date %}value="{{entry_date}}T00:00"{% endif %}>
          <small class="error-inline"></small>
        </div>
      </div>
  {% endcall %}
{% endmacro %}


{% macro time_entry_modal(id='time_entries-entry-dashboard', title='Add Time Entry', current_date=None) %}
  {% call ui.modal('time_tracking', 'time_entries', id, title) %}
    <div>
        <label for="entry_date">Date:</label>
        <input type="date" id="entry_date" name="entry_date" value="{{ current_date }}" required>
    </div>

    <div class="field-pair">
        <div>
            <label for="started_at">Start:</label>
            <input type="time" id="started_at" name="started_at" required>
            <small class="error-inline"></small>
        </div>
        <div>
            <label for="ended_at">End:</label>
            <input type="time" id="ended_at" name="ended_at" required>
            <small class="error-inline"></small>
        </div>
    </div>

    <div>
        <label for="category">Category:</label>
        <input type="text" id="category" name="category" required placeholder="Project Work">
        <small class="error-inline"></small>
    </div>
    <div>
        <label for="description">Description (Optional):</label>
         <textarea id="description" name="description" rows="5" cols="5"
            ></textarea>
        <small class="error-inline"></small>
    </div>
  {% endcall %}
{% endmacro %}

{% macro task_entry_modal(id='tasks-entry-dashboard', title='Add Task') %}
  {% call ui.modal('tasks', 'tasks', id, title) %}
    <div>
      <label for="name">Task:</label>
      <input type="text" id="name" name="name" required>
      <small class="error-inline"></small>
    </div>
    <div>
      <label for="priority">Priority</label>
      <select name="priority" id="priority" required>
        <option value="">--</option>
        <option value="low">Low</option>
        <option value="medium">Medium</option>
        <option value="high">High</option>
      </select>
      <small class="error-inline"></small>
    </div>
    <div>
      <input type="checkbox" id="is_frog" name="is_frog">
      <label for="is_frog">"Daily Frog" Task?</label>
      <small class="error-inline"></small>
    </div>
    <div>
      <label for="due_date">Due Date:</label>
      <input type="date" id="due_date" name="due_date">
      <small class="error-inline"></small>
    </div>
  {% endcall %}
{% endmacro %}

{% macro habit_entry_modal(id='habits-entry-dashboard', title='Add Habit') %}
    {% call ui.modal('habits', 'habits', id, title) %}
        <div>
            <label for="name">Habit:</label>
            <input type="text" id="name" name="name" required>
            <small class="error-inline"></small>
        </div>
        <div>
            <label for="target_frequency">Target (per wk):</label>
            <input type="text" id="target_frequency" name="target_frequency" required
                inputmode="numeric" data-type-int>
            <small class="error-inline"></small>
        </div>
        <div>
            <label for="is_promotable">Promotion-based?</label>
            <input type="checkbox" id="is_promotable" name="is_promotable">
            <small class="error-inline"></small>
        </div>
    {% endcall %}
{% endmacro %}

{% macro leetcode_entry_modal(id='leet_code_records-entry-dashboard', title='Add LeetCode record') %}
    {% call ui.modal('habits', 'leetcode_records', id, title) %}
    <div class="field-pair field-pair--weighted">
        <div>
            <label for="title">Title:</label>
            <input type="text" id="title" name="title">
        </div>
        <div>
            <label for="leetcode_id">Problem ID:</label>
            <input type="text" inputmode="numeric" data-type-int id="leetcode_id" name="leetcode_id" required>
        </div>
    </div>

    <div class="field-pair field-pair--weighted">
        <div>
            <label for="language">Language:</label>
            <select name="language" id="language">
                <option value="Python">Python</option>
                <option value="JavaScript">JavaScript</option>
                <option value="C">C</option>
                <option value="C++">C++</option>
            </select>
        </div>
        <fieldset class="radio-fieldset">
            <legend>Status:</legend>
            <div>
                <input type="radio" id="solved" name="lcstatus" value="solved" checked>
                <label for="solved">Solved</label>
            </div>
            <div>
                <input type="radio" id="attempted" name="lcstatus" value="attempted">
                <label for="attempted">Attempted</label>
            </div>
            <div>
                <input type="radio" id="reviewed" name="lcstatus" value="reviewed">
                <label for="reviewed">Reviewed</label>
            </div>
        </fieldset>
    </div>
    <fieldset class="radio-fieldset">
        <legend>Difficulty:</legend>
        <div>
            <input type="radio" id="easy" name="difficulty" value="easy" checked>
            <label for="easy">Easy</label>
        </div>
        <div>
            <input type="radio" id="medium" name="difficulty" value="medium">
            <label for="medium">Medium</label>
        </div>
        <div>
            <input type="radio" id="hard" name="difficulty" value="hard">
            <label for="hard">Hard</label>
        </div>
    </fieldset>
    {% endcall %}
{% endmacro %}

{% macro product_entry_modal(id='products-entry-dashboard', title='Add Product', list=category_options) %}
    {% call ui.modal('groceries', 'products', id, title) %}
        <div>
            <label for="name">Product Name:</label>
            <input type="text" id="name" name="name" required>
            <small class="error-inline"></small>
        </div>
        <div>
            <label for="barcode">Barcode:</label>
            <input type="text" id="barcode" name="barcode"
                minlength="8" maxlength="14"
                pattern="[0-9]{8,14}"
                placeholder="Scan or enter barcode">
            <small class="error-inline"></small>
        </div>
        <div>
            <label for="category">Category</label>
            <select name="category" id="category" required>
                <option value="" disabled selected hidden data-initial-disabled>--</option>
                {% for category in list %}
                    <option value="{{ category.value }}">{{ category.text.title() }}</option>
                {% endfor %}
            </select>
        </div>
        <div>
            <label for="calories_per_100g">Calories (per 100g):</label>
            <input type="text" inputmode="decimal" data-type-float data-step="0.1" id="calories_per_100g" name="calories_per_100g">
            <small class="error-inline"></small>
        </div>
        <div class="field-pair field-pair--weighted">
            <div>
                <label for="net_weight">Net Weight:</label>
                <input type="text" inputmode="decimal" data-type-float data-step="0.01" id="net_weight" name="net_weight" required>
                <small class="error-inline"></small>
            </div>
            <div>
                <label for="unit_type">Units:</label>
                <select name="unit_type" id="unit_type" required>
                    <option value="" disabled selected>--</option>
                    <option value="g">g (grams)</option>
                    <option value="kg">kg (kilograms)</option>
                    <option value="oz">oz (ounces)</option>
                    <option value="lb">lb (pounds)</option>
                    <option value="ml">ml (milliliters)</option>
                    <option value="l">l (liters)</option>
                    <option value="fl_oz">fl oz (fluid ounces)</option>
                </select>
                <!-- To stabilize grid cell height in this field-pair -->
                <small class="error-inline-UNUSED"></small>
            </div>
        </div>
    {% endcall %}
{% endmacro %}

{% macro transaction_entry_modal(products, id='transactions-entry-dashboard', title='Add Transaction', list=category_options) %}
    {% call ui.modal('groceries', 'transactions', id, title) %}
        <div>
            <label for="product_id">Select Product: </label>
            <select name="product_id" id="product_id" required>
                <option value="">--</option>
                {% for product in products %}
                    <option value="{{ product.id }}">{{ product.name }}{% if product.deleted_at %} (deleted){% endif %}</option>
                {% endfor %}
                <option value="__new__">+ Create New Product</option>
            </select>
            <input type="hidden" name="product_id" id="product_id_hidden" value=""> {# update via JS when we open in edit mode #}
        </div>

        <div class=" field-pair field-pair--weighted">
            <div>
                <label for="price_at_scan">Price (each):</label>
                <input type="text" inputmode="decimal" data-type-float data-step="0.01" id="price_at_scan" name="price_at_scan"
                    value="{{ transaction_data.price_at_scan if transaction_data else '' }}"
                    required>
                <small class="error-inline"></small>
            </div>
            <div>
                <label for="quantity">Quantity:</label>
                <input type="text" inputmode="numeric" data-type-int id="quantity" name="quantity"
                    value="{{ transaction_data.quantity if transaction_data else '' }}"
                    required>
                <small class="error-inline"></small>
            </div>
        </div>

        <div class="product-field" hidden>
            <label for="name">Product Name</label>
            <input type="text" id="name" name="name" disabled required data-initial-disabled>
            <small class="error-inline"></small>
        </div>
        <div class="product-field" hidden>
            <label for="barcode">Barcode:</label>
            <input type="text" id="barcode" name="barcode"
                value="{{ transaction_data.barcode if transaction_data else ''}}"
                minlength="8" maxlength="14"
                placeholder="01234567">
                <small class="error-inline"></small>
        </div>
        <div class="product-field" hidden>
            <label for="category">Category</label>
            <select name="category" id="category" disabled required data-initial-disabled>
                <option value="" disabled selected hidden data-initial-disabled>--</option>
                {% for category in list %}
                    <option value="{{ category.value }}">{{ category.text.title() }}</option>
                {% endfor %}
            </select>
        </div>
        <div class="product-field" hidden>
            <label for="calories_per_100g">Calories (per 100g):</label>
            <input type="text" inputmode="decimal" data-type-float data-step="0.01" id="calories_per_100g" name="calories_per_100g" disabled required data-initial-disabled>
            <small class="error-inline"></small>
        </div>
        <div class="field-pair field-pair--weighted">
            <div class="product-field" hidden>
                <label for="net_weight">Net Weight:</label>
                <input type="text" inputmode="decimal" data-type-float data-step="0.01" id="net_weight" name="net_weight" disabled required data-initial-disabled>
                <small class="error-inline"></small>
            </div>
            <div class="product-field" hidden>
                <label for="unit_type">Units:</label>
                <select name="unit_type" id="unit_type" disabled required data-initial-disabled>
                    <option value="" disabled selected>-- Units --</option>
                    <option value="g">g (grams)</option>
                    <option value="kg">kg (kilograms)</option>
                    <option value="oz">oz (ounces)</option>
                    <option value="lb">lb (pounds)</option>
                    <option value="ml">ml (milliliters)</option>
                    <option value="l">l (liters)</option>
                    <option value="fl_oz">fl oz (fluid ounces)</option>
                </select>
                <!-- To stabilize grid cell height in this field-pair -->
                <small class="error-inline-UNUSED"></small>
            </div>
        </div>
    {% endcall %}
{% endmacro %}

