{# Navbar template used across site. Note: nav_link macro at bottom of this file #}
{# === NAV COMPONENTS === #}

{# NOTE: current_user.role is a string, required_role is now an Enum, hence the '.value' #}
{% macro nav_link(text, endpoint, current_endpoint, required_role=None) %}
    {% if not required_role or (current_user.is_authenticated and current_user.role == required_role.value) %}
        <a href="{{ url_for(endpoint) }}"
        class="nav-link {% if current_endpoint == endpoint %}active{% endif %}"
                        {% if current_endpoint == endpoint %}aria-current="page"{% endif %}>
            {{ text }}
        </a>
    {% endif %}
{% endmacro %}

{# TODO: Note: navlinks is the desktop name, need to rename after switching over logic/styling #}
{% macro navigation_links(type='navlinks') %}
<div class="{{ type }}" id="{{ type }}">
    {{ nav_link('Home', 'main.home', request.endpoint) }}

    {% if current_user.is_authenticated %}
        {{ nav_link('Tasks', 'tasks.dashboard', request.endpoint) }}
        {{ nav_link('Habits', 'habits.dashboard', request.endpoint) }}
        {{ nav_link('Groceries', 'groceries.dashboard', request.endpoint) }}
        {{ nav_link('Metrics', 'metrics.dashboard', request.endpoint) }}
        {{ nav_link('Time Tracking', 'time_tracking.dashboard', request.endpoint) }}

        {{ nav_link('Log out', 'auth.logout', request.endpoint )}}
    {% endif %}
    
    {% if current_user.is_anonymous %}
        {{ nav_link('Log in', 'auth.login', request.endpoint) }}
    {% endif %}
</div>
{% endmacro %}
<div class="nav-anchor">
    <nav aria-label="Main navigation">
        <div class="navbar-content">
            {# LEFT: Branding & Links #}
            <div class="nav-left">
                <a href="{{ url_for('main.home') }}" class="branding">Vesper</a>

                <button id="hamburger-btn"
                        aria-controls="mobilenav" 
                        aria-expanded="false" 
                        aria-label="Toggle navigation menu">
                    ☰
                </button>
                {# TODO: NOTES: ID makes assistive tech tie btn + navlinks together? #}
                {{ navigation_links() }}
            </div>

            {# Settings modal, theme select, etc. #}
            <div class="nav-right">

                {# Baby's first modal #}
                <button id="settings-btn" aria-label="Settings">⚙️</button>
                {% if has_dev_tools %}
                <dialog id="settings-modal" class="dev-buttons">
                    <h3>Hey pal</h3>
                    <p>My Modal Content</p>
                    <a href="/my-fake/route" class="btn btn-primary">Test 404</a>
                    <form action="{{ url_for('auth.reset_dev') }}" method="POST">
                        <button type="submit" class="btn btn-primary">Reset DEV</button>
                    </form>
                    {% if config.APP_ENV == 'dev' %}
                    <a href="{{ url_for('devtools.style_reference')}}" class="btn btn-secondary">Theme Demo Page</a><br>
                    {% endif %}
                    <button type="submit" id="close-dev-modal-btn">Close</button>
                </dialog>
                {% endif %}

                <form>
                    <fieldset>
                        {# Legend here is good for accessibility (screen readers) #}
                        <legend class="visually-hidden">Pick a theme</legend>
                        
                        {# Pivot this to fancier custom toggle (circle of moon/sun moves from one side to another when clicked) #}
                        <select name="theme" id="theme">
                            <option value="laptop">System</option>
                            <option value="sun">Light</option>
                            <option value="moon">Dark</option>
                        </select>
                    </fieldset>
                </form>
            </div>
        </div>
    </nav>

    <div id="mobilenav" class="mobilenav">
        {{ navigation_links('mobilenavlist') }}
    </div>
</div>