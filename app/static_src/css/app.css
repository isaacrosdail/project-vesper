/* Single entry file, declares layer order + imports
 * Defines cascade precedence: lowest = highest priority
 */
@layer base, components, utilities, animations, app;

/* Design tokens live OUTSIDE layers so everything can read vars */
@import './tokens.css';
@import url('./base.css') layer(base);
@import url('./components.css') layer(components);
@import url('./navigation.css') layer(components);
@import url('./utilities.css') layer(utilities);
@import url('./animations.css') layer(animations);

/* Breakpoints:
 * width <= 768px   Mobile nav toggle, chart stacking
 * width > 768px    Hide mobile navlinks?
 * width <= 768px   Hide 'desktop-only' classed table columns
*/

/* Thoughts on z-index standardization (as insurance)
 * 0-99    - Base layout elements
 * 100-199 - Tooltips, dropdowns
 * 200-299 - Context menus, popovers, navbar, sticky side panels
 * 300-399 - Modals, backdrop overlays
 * 400-499 - Toasts, system-level UI (spinners?)
 * 500+    - Debug layer, devtools, etc.
*/

:root {
    --min-navbar-height: 4rem;
    --confetti-size-base: 0.375rem;
}
::selection {
    background-color: var(--bg-selection);
}

legend {
    font-size: var(--font-size-lg);
    font-weight: var(--font-weight-semibold);
}
h3 {
    font-size: var(--font-size-lg);
}

/* ==== MEDIA QUERIES ==== */
@media (width <= 768px) {
    .nav-desktop {
        display: none;
    }
    /* Viewmodels' COLUMN_CONFIGs dictate which table columns per table are 'essential' or 'desktop-only'
       Let's us easily "condense" our tables to provide a better mobile experience */
    .desktop-only {
        display: none;
    }
    /* Suppress underline effect on mobile nav, use bg again */
    .nav-link::after {
        display: none;
    }
    .nav-link:hover {
        background-color: var(--accent-subtle);
    }
}
@media (width > 768px) {
    .hamburger-btn { display: none; }
    .nav-mobile-container { display: none; }
}
/* TODO: Tune this later as we add some basic animations/transitions */
@media (prefers-reduced-motion: reduce) {
    .nav-desktop { transition: none; }
    .icon-wiggle { animation: none; transition: none; }

    /* Disable both surging effect & gradient itself */
    .progress-bar-fill.surging,
    .progress-bar-fill.surging::after {
        animation: none !important;
    }
    .progress-bar-fill.surging::after {
        background: none !important;
    }
}


/* ===================================
    PAGE-SPECIFIC: Groceries Dashboard
   ===================================*/
/* Position our "x" button "outside"/"to the side of" the inline content */
.shoppinglist-item {
    position: relative; /* positioning context for inline-delete */
}
.shoppinglist-item button {
    cursor: pointer;
}
.shoppinglist-item svg {
    width: 100%;
    height: 100%;
    pointer-events: none;
}
.inline-delete {
    display: flex;
    align-items: center;
    justify-content: center;
    position: absolute;
    left: -1.4rem;
    top: 50%; /* position button's top edge at middle of container */
    transform: translateY(-50%); /* then shift up by half its own height to center it vertically */
    width: 20px;
    height: 20px;
    border: 1px solid var(--clr-error);
    /* border-radius: 50%; */
    opacity: 0;
    transition: opacity var(--transition-fade);
}

/* Show hidden controls on hover */
.shoppinglist-item:hover .inline-delete,
.shoppinglist-item:hover .qty-controls button {
    opacity: 1;
}
.qty-controls {
    display: flex;
    gap: var(--gap-sm);
    align-items: center;
}
.qty-controls button {
    opacity: 0;
    transition: opacity var(--transition-fade);
    color: var(--accent-subtle);
    width: 20px;
    height: 20px;
    background: transparent;
    border: 1px solid var(--accent-subtle);
    border-radius: 50%;
}

/* ===================================
    D3 Charts: Habits, Metrics, Time Tracking
   ===================================*/

.chart-title,
.chart-legend-text {
    fill: var(--text);
}

.pie,
.bar,
.line {
    transition: opacity 0.1s ease;
}
.pie:hover,
.bar:hover,
.line:hover {
    opacity: 0.7;
}
svg {
    overflow: visible; /* for hovering pie chart slices */
}

[id$="chart-container"] {
    align-self: center;
}

/* ===================================
    APP LAYOUT / PAGE SHELL
   ===================================*/

/* .wrapper & .content stylings below give us the "sticky footer" at the bottom */
/* Flex container for header/content/footer */
.wrapper {
    min-height: 100vh;
    display: flex;
    flex-direction: column;
    gap: calc(1.5 * var(--gap-lg));
    background-color: var(--bg-dark);
}
/* Main content area: fills remaining viewport space below navbar */
.content {
    flex: 1 0 auto;                        /* only grow vertically */
    width: 100%;                           /* take full width by default */
    max-width: clamp(35rem, 90vw, 90rem);  /* cap width responsively */
    margin-inline: auto;                   /* center horizontally */
    padding-inline: clamp(1rem, 4vw, 2rem);
    display: flex;
    flex-direction: column;
    gap: var(--gap-lg);
}
/* For pages using our content_mod Jinja block to provide narrower styling for content */
.content--narrow {
    max-width: clamp(35rem, 90vw, 50rem);
}

/* ===================================
    PAGE-SPECIFIC: Homepage
   ===================================*/

#greeting-card {
    position: relative;
    height: clamp(150px, 15vh, 300px);
}
#sky-canvas {
    position: absolute;
    inset: 0;
    height: 100%;
    width: 100%;
    z-index: 0;
}
.greeting-content {
    position: relative;
    width: 100%;
    display: flex;
    justify-content: space-between;
    z-index: 1;
}
.weather-info {
    display: flex;
    flex-direction: column;
    place-items: right;
}
.weather-info {
    position: relative;
    display: flex;
    justify-content: right;
    z-index: 1;
}
/* Styling for text of today's frog / LeetCode to distinguish them as 'special' but similar to their corresponding sections */
.highlight-label { 
    font-weight: var(--font-weight-semibold);
}

.progress-bar,
.progress-bar-fill {
    height: 1.25rem;
}
.progress-bar {
    background-color: oklch(85% 0 0);
    border-radius: var(--border-radius);
    border: var(--border-default);
    overflow: hidden; /* make rounded edges clean on lower percentages, effectively 'clips' overlap */
    width: 80%;
    max-width: 300px;
}
.progress-bar-fill {
    position: relative; /* positioning context for progress-bar-fill::after */
    background: var(--progress-bar-fill);
    transform: scaleX(0); /* JS can set scaleX using our percent progress directly this way */
    transform-origin: left; /* fill acts as a mask, 'peels back' to reveal gradient of progress-bar */
    transition: transform 0.2s ease-in-out;
    overflow: hidden; /* clips our ::after's pulsing effect cleanly */
}
.progress-bar-fill::after {
    content: "";
    position: absolute;
    top: 0;
    left: 0;
    height: 100%;
    width: 50%;
}
.progress-bar-fill.surging {
    animation: pulse 1.5s ease-in-out infinite;
}
.progress-bar-fill.surging::after {
    background: linear-gradient(
        to right,
        transparent,
        rgba(255,255,255, 0.4),
        transparent
    );
    animation: surge 1.5s ease-in-out infinite;
}

#confetti-layer {
    position: fixed;
    pointer-events: none;
    top: 0; left: 0;
    width: 100vw;
    height: 100vh;
    z-index: 50;
    overflow: visible;
}
.dot {
    position: absolute;
    pointer-events: none;
    top: 50%;
    left: 50%;
    height: var(--confetti-size-base);
    width: var(--confetti-size-base);
    transform: translate(-50%, -50%);
    offset-rotate: 0deg;
    /* offset-path: path('M 0 0 Q 40 -150 80 -120'); Quad Bezier */
}
/* Sprucing our confetti up with some shapes */
.star {
    background: gold;
    clip-path: polygon(
        50% 0%,
        61% 35%,
        98% 35%,
        68% 57%,
        79% 91%,
        50% 70%,
        21% 91%,
        32% 57%,
        2% 35%,
        39% 35%
    )
}
.circle {
    background: green;
    border-radius: 50%;
}
.diamond {
    background: purple;
    clip-path: polygon(50% 0%, 84% 46%, 50% 100%, 15% 47%);
}
.parallelogram {
    background: orange;
    clip-path: polygon(25% 0%, 100% 0%, 75% 100%, 0% 100%);
}
.triangle {
    background: blue;
    clip-path: polygon(50% 0%, 0% 100%, 100% 100%);
}

/* ===================================
    PAGE-SPECIFIC: Login / Register Pages
   ===================================*/
.password-input-group {
    position: relative;
}
.password-input-group input {
    width: 100%;
    padding-right: 2rem;
}
.password-input-group > button {
    position: absolute;
    top: 50%;                    /* puts top edge at the middle */
    transform: translateY(-50%); /* move down by half its height */
    right: 0.5rem;
}
.password-toggle .slash {
    stroke-dasharray: 26;  /* total length of slash line */
    stroke-dashoffset: 26; /* hide line to start */
    transition: stroke-dashoffset 0.2s ease;
}
.password-toggle[aria-pressed="true"] .slash {
    stroke-dashoffset: 0; /* draw line in */
}

/* ===================================
    PAGE-SPECIFIC: Landing Page
   ===================================*/

/* Container for landing page content */
.landing-content {
    overflow: hidden;
    align-items: center;
    padding: var(--space-xl) var(--space-md);
}
/* Cap the paragraph for legibility */
.landing-content p {
    max-width: 60ch;
    color: var(--text-muted);
}
.landing-content h1 {
    font-size: var(--font-size-xxl);
    font-weight: var(--font-weight-semibold);
    margin-bottom: var(--space-sm);
}
.landing-content a {
    text-align: center;
}

/* ===================================
    PAGE-SPECIFIC: Error Page(s)
   ===================================*/
/* 404 + 500 error pages */
.error-page {
    display: flex;
    flex-direction: column;
    gap: var(--gap-md);
    text-align: center;
    align-items: center;
}
.error-page > h1 {
    font-size: var(--font-size-xxl);
}
/* TODO: Rename*/
.icon-wiggle {
    width: clamp(12rem, 30vw, 20rem);
    height: auto;
    display: block;
}

/* ===================================
    PAGE-SPECIFIC: Style-reference Page
   ===================================*/

/* Override stylng to position dummy context menu */
.context-menu-positioning {
    position: relative;
}
/* Override btn-icon styling to show borders for debug/tuning */
html[data-page="devtools.style_reference"] .btn-icon {
    border: 1px solid red;
}

/* Base grid styles, shared by all demo containers */
.demo-section,
.demo-subsection,
.demo-grid-container {
    display: grid;
    gap: var(--gap-md);
}
/* Overall section-level grids */
.demo-section {
    grid-template-rows: auto 1fr; /* Headers + "rest" */
}
/* Subsections within said section grids (per component) */
.demo-subsection {
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
}
/* Grid defaults for token tiles */
.demo-grid-container { 
    /* Creates as many columns as will fit, each a min of 40px but grows evenly to fill space */
    grid-template-columns: repeat(auto-fit, minmax(40px, 1fr));
    align-items: center; /* controls vertical alignment of content inside each grid cell */
}
/* To make border-color clearly visible for tuning */
.token-container {
    border: 4px solid var(--border-color);
}
.tile,
.stepped-bg,
.stepped-accents {
    border: var(--border-default);
    border-radius: var(--border-radius);
}
/* Design token tiles - smaller */
.tile {
    aspect-ratio: 1;
    display: flex;
    align-items: center;
    justify-content: center;
    max-width: 100px;
}
/* Stepped gradient tiles for bg/accents */
.stepped-bg,
.stepped-accents {
    grid-column: 1 / -1; /* span the whole row */
    display: flex;
    justify-content: space-evenly; /* distribute labels evenly across */
    align-items: center;
    height: 80px;
}
/* Stepped gradient backgrounds */
.stepped-bg {
    background: linear-gradient(
        to right in oklch,
        var(--bg-dark)   0%, var(--bg-dark)  25%,
        var(--bg)       25%, var(--bg)       50%,
        var(--bg-light) 50%, var(--bg-light) 75%,
        var(--bg-hover) 75%, var(--bg-hover) 100%
    );
}
.stepped-accents {
    background: linear-gradient(
        to right in oklch,
        var(--accent-strong)   0%, var(--accent-strong)  33%,
        var(--accent-subtle)  33%, var(--accent-subtle)  66%,
        var(--accent-hover)   66%, var(--accent-hover)   100%
    );
}
.progbar {
    grid-column: 1 / -1;
    border: var(--border-default);
    align-items: center;
    height: 80px;
}
.progbar.one {
    background: linear-gradient(
        to right in oklch,
        oklch(85% 0.09 145),
        oklch(80% 0.15 145)
    );
    border-radius: var(--border-radius);
}
.progbar.two {
    background: linear-gradient(
        to right in oklch,
        oklch(88% 0.04 145),
        oklch(75% 0.14 145)
    );
    border-radius: var(--border-radius);
}

.progbar.three {
    background: linear-gradient(
        to right in oklch,
        oklch(90% 0.18 135),
        oklch(65% 0.20 150)
    );
    border-radius: var(--border-radius);
}
.progbar.four {
    background: linear-gradient(
        to right in oklch,
        oklch(80% 0.10 80),
        oklch(75% 0.14 145),
        oklch(70% 0.18 145)
    );
    border-radius: var(--border-radius);
}
.progbar.five {
    background: linear-gradient(
        to right in oklch,
        oklch(85% 0.08 180),
        oklch(70% 0.14 145)
    );
    border-radius: var(--border-radius);
}
.progbar.six {
    background: linear-gradient(
        to right in oklch,
        oklch(88% 0.09 145),
        oklch(82% 0.12 145),
        oklch(78% 0.19 150)
    );
    border-radius: var(--border-radius);
}
.progbar.seven {
    background: linear-gradient(
        to right in oklch,
        oklch(85% 0.10 80),
        oklch(78% 0.12 135),
        oklch(72% 0.14 145)
    );
    border-radius: var(--border-radius);
}
.progbar.seven {
    background: linear-gradient(
        to right in oklch,
        oklch(82% 0.09 130),
        /* Uptime Robot green anchor */
        oklch(77% 0.19 150.37)
    );
    border-radius: var(--border-radius);
}
