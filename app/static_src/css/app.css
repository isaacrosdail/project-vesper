/* Single entry file, declares layer order + imports
 * Defines cascade precedence: lowest = highest priority
 */
@layer base, components, utilities, animations, app;

/* Design tokens live OUTSIDE layers so everything can read vars */
@import url('./tokens.css');
@import url('./base.css') layer(base);
@import url('./components.css') layer(components);
@import url('./navigation.css') layer(components);
@import url('./utilities.css') layer(utilities);
@import url('./animations.css') layer(animations);

/* Breakpoints:
 * width <= 768px   Mobile nav toggle, chart stacking
 * width > 768px    Hide mobile navlinks?
 * width <= 768px   Hide 'desktop-only' classed table columns
*/

/* Thoughts on z-index standardization (as insurance)
 * 0-99    - Base layout elements
 * 100-199 - Dropdowns
 * 200-299 - Context menus, popovers, navbar, sticky side panels
 * 300-399 - Modals, backdrop overlays
 * 400-499 - Toasts, system-level UI (spinners?)
 * 500+    - Debug layer, devtools, etc.
 * 999     - Confetti / joyous celebration effects
 * 1000    - Tooltips
*/

:root {
    --min-navbar-height: 4rem;
    --confetti-size-base: 0.375rem;

    /* D3 charts starting dimensions */
    --chart-width: 400px;
    --chart-height: 300px;
}
::selection {
    background-color: var(--bg-selection);
}

fieldset {
    background: var(--bg-light);
    border: var(--border-default);
    border-radius: var(--border-radius);
}
legend {
    margin-bottom: var(--gap-sm);
    font-size: var(--font-size-lg);
    font-weight: var(--font-weight-semibold);
}
input {
    accent-color: var(--accent-subtle);
}

h2 {
    font-size: var(--font-size-lg);
    font-weight: var(--font-weight-semibold);
}
h3 {
    font-size: var(--font-size-lg);
}
label {
    font-weight: var(--font-weight-semibold);
}
textarea {
    resize: none;
}
footer {
    padding: 8px;
    font-size: var(--font-size-sm);
    color: var(--text-muted);
    text-align: center;
}

@media (width <= 600px) {
    /* TODO: Overriding utility class used for form modals mostly */
    .field-pair,
    .field-pair--weighted {
        grid-template-columns: 1fr;
    }
}

/* ==== MEDIA QUERIES ==== */
@media (width <= 768px) {
    .nav-desktop {
        display: none;
    }

    /* Viewmodels' COLUMN_CONFIGs dictate which table columns per table are 'essential' or 'desktop-only'
       Let's us easily "condense" our tables for mobile */
    .desktop-only {
        display: none;
    }

    /* Suppress underline effect on mobile nav, use bg again */
    .nav-link::after {
        display: none;
    }
    .nav-link:hover,
    .nav-link[aria-current="page"] {
        border-radius: var(--border-radius);
    }
    .nav-link:hover {
        background-color: var(--accent-subtle);
    }
    .nav-link[aria-current="page"] {
        background-color: color-mix(in oklch, var(--accent-subtle) 85%, grey);
    }
}
@media (width > 768px) {
    .hamburger-btn { display: none; }
    .nav-mobile-container { display: none; }

    .nav-link:hover::after,
    .nav-link[aria-current="page"]::after {
        width: 100%;
    }
}

/* TODO: Tune this later as we add some basic animations/transitions */
@media (prefers-reduced-motion: reduce) {
    .nav-desktop { transition: none; }
    .icon-wiggle {
        transition: none;
        animation: none;
    }

    /* Disable both surging effect & gradient itself */
    .progress-bar-fill.surging,
    .progress-bar-fill.surging::after {
        animation: none !important;
    }
    .progress-bar-fill.surging::after {
        background: none !important;
    }
}

/* ===================================
    PAGE-SPECIFIC: Tasks Dashboard
   =================================== */
td .status-span > svg {
    display: none;
}
td .status-span.is-done > svg {
    display: block;
    stroke: var(--clr-success);
}

/* ===================================
    PAGE-SPECIFIC: Groceries Dashboard
   =================================== */
#list-empty {
    font-style: italic;
    color: var(--text-muted);
}
.shopping-list {
    display: flex;
    flex-direction: column;
}

/* Position our "x" button "outside"/"to the side of" the inline content */
.shoppinglist-item {
    position: relative; /* positioning context for inline-delete */
    display: grid;
    grid-template-columns: 1fr 1fr;
    align-self: start;
}
.shoppinglist-item svg {
    width: 100%;
    height: 100%;
    pointer-events: none;
}
.inline-delete {
    position: absolute;
    top: 50%; /* position button's top edge at middle of container */
    left: -1.4rem;
    display: flex;
    align-items: center;
    justify-content: center;
    width: 20px;
    height: 20px;
    border: 1px solid var(--clr-error);
    opacity: 0;
    transform: translateY(-50%); /* then shift up by half its own height to center it vertically */
    transition: opacity var(--transition-fade);
}

.qty-controls {
    display: flex;
    gap: var(--gap-sm);
    align-items: center;
}
.qty-controls button {
    width: 20px;
    height: 20px;
    color: var(--accent-subtle);
    background: transparent;
    border: 1px solid var(--accent-subtle);
    border-radius: 50%;
    opacity: 0;
    transition: opacity var(--transition-fade);
}

/* Show hidden controls on hover */
.shoppinglist-item:hover .inline-delete,
.shoppinglist-item:hover .qty-controls button {
    opacity: 1;
}

/* ===================================
    D3 Charts: Habits, Metrics, Time Tracking
   =================================== */

/* TODO: Refine / refactor */
.chart-title,
.chart-legend-text {
    fill: var(--text);
}

.pie,
.bar,
.line {
    transition: opacity 0.1s ease;
}
.pie:hover,
.bar:hover,
.line:hover {
    opacity: 0.7;
}
svg {
    overflow: visible; /* for hovering pie chart slices */
}

/* Gonna centrally size our D3 charts here as well to prevent pop-in/down on render */
[id$="chart-container"] {
    align-self: center;
    width: var(--chart-width);
    height: var(--chart-height);
}

/* ===================================
    APP LAYOUT / PAGE SHELL
   =================================== */

/* .wrapper & .content stylings below give us the "sticky footer" at the bottom */

/* Flex container for header/content/footer */
.wrapper {
    display: flex;
    flex-direction: column;
    gap: calc(1.5 * var(--gap-lg));
    min-height: 100vh;
    background-color: var(--bg-dark);
}

/* Main content area: fills remaining viewport space below navbar */
.content {
    display: flex;
    flex: 1 0 auto;                        /* only grow vertically */
    flex-direction: column;
    gap: var(--gap-lg);
    width: 100%;                           /* take full width by default */
    max-width: clamp(35rem, 90vw, 90rem);  /* cap width responsively */
    padding-inline: clamp(1rem, 4vw, 2rem);
    margin-inline: auto;                   /* center horizontally */
}

/* For pages using our content_mod Jinja block to provide narrower styling for content */
.content--narrow {
    max-width: clamp(35rem, 90vw, 50rem);
}
.card--narrower {
    align-self: center;
    width: clamp(15rem, 90vw, 25rem);
}


.faded-field {
    opacity: 0.7;
}
.faded-field:focus-within {
    opacity: 1;
}

/* Don't fade when invalid
    TODO: Update this when we use our own validation
*/
.faded-field:has(:user-invalid) {
    opacity: 1;
}

/* For drafting the frontend validation stuff for username on register */
[class^="error-inline"] {
    background: rgb(219 149 149);
}


/* ===================================
    PAGE-SPECIFIC: Homepage
   =================================== */

#greeting-card {
    position: relative;
    height: clamp(150px, 15vh, 300px);
}
#sky-canvas {
    position: absolute;
    inset: 0;
    z-index: 0;
    width: 100%;
    height: 100%;
}
.greeting-content {
    position: relative;
    z-index: 1;
    display: flex;
    justify-content: space-between;
    width: 100%;
}
.weather-info {
    position: relative;
    z-index: 1;
    display: flex;
    flex-direction: column;
    place-items: end;
    justify-content: right;
}

/* Styling for text of today's frog / LeetCode to subtly emphasize them */
.highlight-label { 
    font-weight: var(--font-weight-semibold);
}

/* Vertical stack for frog + task list */
.tasks-section {
    display: grid;
    gap: var(--space-sm);
}

/* Accent 'card' to highlight priority items (accent lborder + bg-light) used for today's frog */
.highlight-item {
    padding: var(--space-xs);
    padding-left: var(--space-sm);
    background: var(--bg-light);
    border-left: 4px solid var(--accent-subtle);
    border-radius: calc(0.8 * var(--border-radius));
}

.progress-bar,
.progress-bar-fill {
    height: 1.25rem;
}
.progress-bar {
    width: 80%;
    max-width: 300px;
    overflow: hidden; /* make rounded edges clean on lower percentages, effectively 'clips' overlap */
    background-color: oklch(85% 0 0deg);
    border: var(--border-default);
    border-radius: var(--border-radius);
}
.progress-bar-fill {
    position: relative; /* positioning context for progress-bar-fill::after */
    overflow: hidden; /* clips our ::after's pulsing effect cleanly */
    background: var(--progress-bar-fill);
    transform: scaleX(0); /* JS can set scaleX using our percent progress directly this way */
    transform-origin: left; /* fill acts as a mask, 'peels back' to reveal gradient of progress-bar */
    transition: transform 0.2s ease-in-out;
}
.progress-bar-fill::after {
    position: absolute;
    top: 0;
    left: 0;
    width: 50%;
    height: 100%;
    content: "";
}
.progress-bar-fill.surging {
    animation: pulse 1.5s ease-in-out infinite;
}
.progress-bar-fill.surging::after {
    background: linear-gradient(
        to right,
        transparent,
        rgb(255 255 255 / 40%),
        transparent
    );
    animation: surge 1.5s ease-in-out infinite;
}

/* NOTE: confetti-layer is a z-index/overflow container only.
 * Particle positions are calculated via JS getBoundingClientRect(), not relative to this element's position.
 */
#confetti-layer {
    position: fixed;
    top: 0; left: 0;
    z-index: 999;
    width: 100vw;
    height: 100vh;
    overflow: visible;
    pointer-events: none;
}
.dot {
    position: absolute;
    top: 50%;
    left: 50%;
    width: var(--confetti-size-base);
    height: var(--confetti-size-base);
    pointer-events: none;
    transform: translate(-50%, -50%);
    offset-rotate: 0deg;
}

/* Sprucing our confetti up with some shapes */
.star {
    background: gold;
    clip-path: polygon(
        50% 0%,
        61% 35%,
        98% 35%,
        68% 57%,
        79% 91%,
        50% 70%,
        21% 91%,
        32% 57%,
        2% 35%,
        39% 35%
    )
}
.circle {
    background: green;
    border-radius: 50%;
}
.diamond {
    background: purple;
    clip-path: polygon(50% 0%, 84% 46%, 50% 100%, 15% 47%);
}
.parallelogram {
    background: orange;
    clip-path: polygon(25% 0%, 100% 0%, 75% 100%, 0% 100%);
}
.triangle {
    background: blue;
    clip-path: polygon(50% 0%, 0% 100%, 100% 100%);
}

/* ===================================
    PAGE-SPECIFIC: Login / Register Pages
   =================================== */

/* For "Log in" and "Sign up" anchor tags */
.link-action {
    font-weight: var(--font-weight-semibold);
    color: var(--accent-subtle);
}
.link-action:hover {
    text-decoration: underline;
}
label[for="remember_user"] {
    display: inline-flex;
    gap: var(--gap-sm);
    align-items: center;
}


.password-input-group {
    position: relative;
}
.password-input-group input {
    width: 100%;
    padding-right: var(--space-lg);
}

.password-input-group > button {
    position: absolute;
    top: 50%;                    /* puts top edge at the middle */
    right: var(--space-sm);
    transform: translateY(-50%); /* move down by half its height */
}
.password-toggle {
    color: var(--accent-strong);
    opacity: 1;
    transition: opacity 0.2s ease, color 0.2s ease;
}
.password-toggle[aria-pressed="true"] {
    color: var(--text-muted);
    opacity: 0.8;
}
.password-toggle .slash {
    stroke-dasharray: 26;  /* total length of slash line */
    stroke-dashoffset: 26; /* hide line to start */
    transition: stroke-dashoffset 0.2s ease;
}
.password-toggle[aria-pressed="true"] .slash {
    stroke-dashoffset: 0; /* draw line in */
}

/* ===================================
    PAGE-SPECIFIC: Landing Page
   =================================== */

/* Container for landing page content */
.landing-content {
    display: flex;
    flex-direction: column;
    gap: var(--gap-lg);
    align-items: center;
    padding: var(--space-xl) var(--space-md);
    overflow: hidden; /* ?? */
}

/* Cap the paragraph for legibility */
.landing-content p {
    max-width: 60ch;
    color: var(--text-muted);
    text-align: center;
}
.landing-content h1 {
    font-size: var(--font-size-xxl);
    font-weight: var(--font-weight-semibold);
}
.landing-content a {
    text-align: center;
}
.landing-actions {
    display: flex;
    flex-wrap: wrap;
    gap: var(--gap-sm);
}

/* ===================================
    PAGE-SPECIFIC: Error Page(s)
   =================================== */

/* 404 + 500 error pages */
.error-page {
    display: flex;
    flex-direction: column;
    gap: var(--gap-md);
    align-items: center;
    text-align: center;
}
.error-page > h1 {
    font-size: var(--font-size-xxl);
}

.icon-wiggle {
    display: block;
    width: clamp(12rem, 30vw, 20rem);
    height: auto;
}

/* ===================================
    PAGE-SPECIFIC: Style-reference Page
   =================================== */

/* Override stylng to position dummy context menu */
.context-menu-positioning {
    position: relative;
}

/* Override btn-icon styling to show borders for debug/tuning */
html[data-page="devtools.style_reference"] .btn-icon {
    border: 1px solid red;
}

/* Base grid styles, shared by all demo containers */
.demo-section,
.demo-subsection,
.demo-grid-container {
    display: grid;
    gap: var(--gap-md);
}

/* Overall section-level grids */
.demo-section {
    grid-template-rows: auto 1fr; /* Headers + "rest" */
}

/* Subsections within said section grids (per component) */
.demo-subsection {
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
}

/* Grid defaults for token tiles */
.demo-grid-container { 
    /* Creates as many columns as will fit, each a min of 40px but grows evenly to fill space */
    grid-template-columns: repeat(auto-fit, minmax(40px, 1fr));
    align-items: center; /* controls vertical alignment of content inside each grid cell */
}

/* To make border-color clearly visible for tuning */
.token-container {
    border: 4px solid var(--border-color);
}
.tile,
.stepped-bg,
.stepped-accents {
    border: var(--border-default);
    border-radius: var(--border-radius);
}

/* Design token tiles - smaller */
.tile {
    display: flex;
    align-items: center;
    justify-content: center;
    max-width: 100px;
    aspect-ratio: 1;
}

/* Stepped gradient tiles for bg/accents */
.stepped-bg,
.stepped-accents {
    display: flex;
    grid-column: 1 / -1; /* span the whole row */
    align-items: center;
    justify-content: space-evenly; /* distribute labels evenly across */
    height: 80px;
}

/* Stepped gradient backgrounds */
.stepped-bg {
    background: linear-gradient(
        to right in oklch,
        var(--bg-dark)   0%, var(--bg-dark)  25%,
        var(--bg)       25%, var(--bg)       50%,
        var(--bg-light) 50%, var(--bg-light) 75%,
        var(--bg-hover) 75%, var(--bg-hover) 100%
    );
}
.stepped-accents {
    background: linear-gradient(
        to right in oklch,
        var(--accent-strong)   0%, var(--accent-strong)  33%,
        var(--accent-subtle)  33%, var(--accent-subtle)  66%,
        var(--accent-hover)   66%, var(--accent-hover)   100%
    );
}
.progbar {
    grid-column: 1 / -1;
    align-items: center;
    height: 60px;
    background: var(--progress-bar-fill);
    border: var(--border-default);
    border-radius: var(--border-radius);
}