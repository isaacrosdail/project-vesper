## APRIL, 2025 - Month 2

## [Tue 01.04.25]

**Goal(s):**
- Add "daily tether(s)" UI element to dashboard page  
  - Use Flexbox  
  - Centered card layout  
  - Hover effects  
  - Editable state  
  - Clean styling  
**Log:**
- Modified `index.html` to include `tether-card` div
- Began styling the card layout


## [Wed 02.04.25]
**Goal(s):**
- Finish JS logic for `tether-card` input  
  - Centered card, hover effects, editable state  
  - Clean styling, padding, spacing
**Log:**
- Block 1: Added JS to handle `tether-card` input
- Block 2: Added JS to hide button/input field once tether text is submitted
- Got sidetracked writing a couple unit tests—will revisit after completing styling
**Next Steps:**
- Finish JS styling
- Add unit tests for all functions in `groceries/repository.py`
- Add DB model for storing `tether-card` info (optional)
- Add WebSocket support to redirect to `/add_product` when scanned barcode is not found


## [Fri 04.04.25]

**Goal(s):**
- Expand unit testing coverage, starting with DB logic in `groceries/repository.py`
**Log:**
- Added input validation to `add_product`
- Added test cases for `add_product`:
  - Happy path  
  - Missing data  
  - Invalid price range
- Added 'no entries' & 'with entries' test cases for `get_all_products`
- Added test cases for `get_all_transactions`:  
  - No entries  
  - With entry  
  - Confirmed `joinedload` still works after session close
**Next Time:**
1. Expand test coverage:
   - `add_product`, `add_transaction`
   - `process_scanned_barcode`, `ensure_product_exists`


## [Wed 09.04.25]
**Goals:**
- Add `tasks` module and corresponding template
**Log:**
- Migrated to Blueprint architecture for routes:
  - `main`, `grocery`, and `tasks` (auth pending)
- Restructured `app/` directory
- Added pytest config


## [Thu 10.04.25]

**Goals:**
- Flesh out `tasks.html` and implement 3 recurring habits  
- *(Stretch)* Add habit streak UI
**Log:**
- Added `add_task` template
- Created `modules/tasks/repository.py` for DB logic
- Used GET/POST in `tasks_routes.py` to process form data and render `tasks.html` with task table

**Log:**
- Rendered “Today’s Habits” list on dashboard  
  - Filtered `Tasks` by habit type and `is_anchor` flag
- Added checkbox to mark task complete:
  - Used `fetch()` to POST to DB when clicked (via `onclick`)
  - Current state:
    - ❌ Feature not yet functional
    - `complete_task()` in `tasks_routes.py` needs to:
      - Identify task
      - Extract data from request
      - Set `is_done = True` and `completed_at = today`
    - JS only handles marking complete (unchecking doesn't undo)
    - Need to sanitize `completed_at` as date object
**Next Up:**
- Mark habit complete → update timestamp  
- Auto-reset daily via cronjob or first-run check


## [Fri 11.04.25]

**Log:**
- `complete_task()`:
  - Locates task
  - Sets `is_done = True`
  - Adds `completed_at = today`
  - Returns `jsonify(success=True)` to JS
- Updated `create_app()` to accept environment config params (`testing`, `dev`, etc)
  - Added `config.py` with `BaseConfig`, `DevConfig`, and `TestConfig`
- Installed Docker for PostgreSQL to replace SQLite
- Created `vesper` and `vesper_test` DBs in Docker container
  - Updated Vesper config to point to correct URIs
- Installed `psycopg2-binary` in venv + added to `requirements.txt`
- All tests now run against PostgreSQL test DB  
  - Accurate `datetime` behavior and schema validation

## [Sat 12.04.25]

**Log:**
- Switched fully to PostgreSQL
- Installed `pytest-postgresql` for testing (added to `requirements.txt`)
- Uninstalled `psycopg2-binary`, installed `psycopg[binary]` instead (backend performance?)
- Installed local PostgreSQL for `pytest-postgresql` usage  
  - Local → for tests  
  - Docker container → for dev
- Ditched `pytest-postgresql` (broken / unmaintained)
  - Will connect tests directly to container DB
- Blocker: `pytest` can’t authenticate to DB
  - Password auth keeps failing despite being correct
  - Tried editing `pg_hba.conf` to allow local password auth (`md5`), no success


## [Sun 13.04.25]

**Log:**
- Set up PostgreSQL in Docker using `docker-compose.yml` and `init.sql`
- Integrated DB with Flask app and verified via:
  - Connection test
  - Table creation
  - Rollbacks
  - Constraint enforcement
- Structured test suite:
  - `unit/` and `integration/` folders
  - Configured `pytest.ini`
- Wrote first integration test: full task creation + completion flow
- Merged GET/POST logic into unified `/add_transaction` route
- Refactored DB session handling:
  - Switched to `scoped_session` with automatic teardown
  - No more manual `.close()`
  - Monkeypatched `get_db_session()` in tests to unify test + app session → avoids `DetachedInstanceError`
- Replaced unnecessary `.commit()`s in tests with `.flush()` for isolation
- All tests pass, including edge cases
- Achieved near/full 100% test coverage
- Used test failures to detect & fix real bugs
- Cleaned up:
  - Removed dead comments
  - Renamed helpers
  - Standardized naming across modules
**TODOs:**
- Add toggle logic to tasks checkbox  
  → e.g., `/tasks/toggle/<id>`
- Design anchor habit model (`is_anchor: bool`)  
  → Add repo, route, test flow
- Maintain 100% test coverage  
  → Track deltas post-commit


## [Tue 15.04.25]

**Log:**
- Created `Backups/Vesper` directory for PostgreSQL container DB backups
- Centralized scripts under `User/Scripts` and added to `PATH`
  - Now `vesper-db-backup` command works from anywhere in PowerShell
- Implemented full CRUD for `tasks` (except DELETE)
  - Merged `complete_task` logic into PATCH section of new `update_task` route
- Created `tasks/dashboard.js`:
  - Enables direct cell editing via JS + `fetch()` PATCH requests
- Began generalizing `editTableField()` JS function to support editing across any Vesper table
- Initialized `npm`, set up Jest for JS unit testing:
  - Chose `node` env, used `v8` for coverage
  - Disabled coverage reports for now
  - Enabled auto-clear of mocks before each test
- Installed `jest-environment-jsdom` to mimic DOM & confirmed test runs
**NOTE:**
- Plan: Use **Jest** for unit testing, **Cypress** for end-to-end tests
- Consider generalizing CRUD into a shared `crud_routes.py` later


## [Wed 16.04.25]
**Log:**
- Added DELETE route for `tasks`
- Added JS to dynamically show delete button on row hover
- Began switch from Bootstrap → Tailwind CSS
	- Recreated most of the navbar styling in Tailwind