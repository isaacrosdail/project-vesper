## JUNE, 2025 - Month 4

## [Fri 06.06.25]
**Goals:**
1. Add 2 models:
	1. DailyIntention model -> DONE
	2. DailyMetric model -> DONE
	3. Alembic revision!
2. Make Daily Intention on homepage now use/update our new model instead of just the element's text!

**Log:**
1. Made DailyIntention & DailyMetric models
	- Alembic revision
		- Ran into issue: Since we switched from vesper to vesper_dev for our dev DB, vesper_dev didn't have an 'alembic_version' table (which is why alembic current showed nothing), but it DID have actual tables from previous migrations.
			- Fix: Just needed to run 'alembic stamp head', which basically tells Alembic: "Hey Alembic, we're actually at the latest migration"
				- It creates the alembic_version table in vesper_dev, marks it as being our latest migration, & gets everything in sync!
				- Then, we could run our revision and run alembic upgrade head
				
2. Updated Daily Intention on homepage to use DB for persistence
	- Added created_at field to DailyIntention model
	- Created get_today_intention() function in habits_repository.py
	- Updated homepage route to fetch & pass today's intention to template
	- Modified index.html: added Jinja conditional to use intention OR default text, refactor critical-task to daily-intention
Key Changes: DB schema, repository layer, route logic, template rendering

3. Other changes:
	- Fixed lazy loading errors (sneaky!) by moving habit completion logic from templates to backend
	- Refactored index.html dashboard route to pre-calculate completion status and streaks as dictionaries

**Where I Left Off:**
- Started test_habits_habit_logic.py unit test file to suss out possible race condition with our AJAX

## [Sun 08.06.25]
**Log:**
- Refactored DB management from create_all() to Alembic migrations

## [Mon 09.06.25]
**Log:**
- Added a custom base class for basics like id & timestamp information
	- Ran Alembic revision & refactored accordingly to use updated references
- Clean up environment variable handling a bit, wrap seed_dev_db route in env var conditional check

## [Tues 10.06.25]
**Goals:**
1. Get started with weather API calls
**Log:**
1. Weather API calls
	- Sign up for OpenWeatherMap (personal em, made filter for it)
	- Add API key to .env (local & server)
	- Make new api.py to use it via Flask
**Learned:**
- Async/await, basic JSON handling

## [Wed 11.06.25]
**Goals:**
1. Expand weather API widget functionality a bit
2. Start implementing an animated sun arc
	- Begin with Jest for testing pieces of this
	- Added "testEnvironment: 'jsdom'" to jest.config.js (fake browser environment)
	- Wrapped DOM code in safety checks: if (element) { element.onclick = ... }
**Log:**
1. Expanded weather API widget functionality
	- Grab sunset time
	- Make emojis display conditionally depending on weather description
2. Animated Sun arc
	- Figured out the math for a moving sun that follows actual sunrise/sunset times
	- Learned Canvas basics for this: Set up first Canvas element & drawing functions
	- Refactored these functions to separate pure match function to prep for testing
3. Diving back into Jest testing
	- Made a basic 2 + 2 = 4 Jest test
	- then a test to calc sun position at midday (should be 1)
4. Using setInterval for both getWeatherInfo & sun drawing functionalities
	- Weather info updates every hour, sun position updates every 10mins
**Learned:**
- JS modules are a mess
- Canvas coordinate system & basic transform
- Async/await flow with setInterval timing
- Separating data fetching from data usage (global caching)

**Up Next:**
1. Stylize sun so it's clearer what it is (add horizon, sun rays, etc?)
2. Add tooltip for onhover of canvas to further clarify that it moves in realtime/follows the real sun position based on sunrise and sunset of the city
3. Make it read user's timezone/city so it's not hardcoded to London

## [Thurs 12.06.25]
**Log:**
- Remove super() usage in templates, refactor completed_at to created_at to fix bug with HabitCompletion

## [Fri 13.06.25] - Mobile Nav Polish & Dev Tooling
**Log:**
1. Began hamburger/mobilenav menu
  - Started with JS resize detection (incl. throttling) but simplified to CSS media queries with JS for state cleanup later.
2. Docker & Deployment Standardization
  - Restructured compose files: docker-compose.yml (dev), docker-compose.pi.yml (pi deployment), docker-compose.prod.yml (production)
  - Updated all APP_ENV variables from old FLASK_ENV pattern
  - Added proper volume and container naming conventions (-dev, -pi, -prod suffixes)
3. CI/CD Updates
  - Modified Actions to use correct compose files per environment
  - Added deployment flow for Pi vs prod
4. Code Quality Infra
  - Set up TypeScript, ESLint, and Husky for code quality and pre-commit checks
5. Misc
 - Fixed some ESLint warnings, cleaned up rest of super() usage, & added notes for future moon implementation.

## [Sun 15.06.25]
**Log:**
- Added sunrays using stroke to clarify sun styling

## [Wed 18.06.25]
**Log:**
1. Revamped Product model & Tables
	- Hide ID columns in production (is_dev reference)
	- Replaced price field with category, unit_type, and calories_per_100g
	- Updated migrations, seed data, forms, and repository functions
	- Added dropdown selects for category & unit_type fields
	- Tweaked groceries Products table to reflect schema changes
	- Cleaned up zombie 'price' references
2. Added Category system to Habits
	- Added 'Category' field to Habit model (default='misc')
	- Added dropdown input in add_habit form
	- Updated seed_db & seed_dev_db accordingly
3. Start on "Daily Check-In" widget (index.html)
	
## [Thurs 19.06.25]
**Log:**
1. Implemented User model basics
	- Created User model with username field & user_id
	- Refactored CustomBase to be split into Timestamp mixin & BaseModel
	- Updated seed_db to create default user
2. Updated Product/Transaction models
	- Added str methods
	- Fixed routes to handle new Product fields
3. Bit more on Daily Check-In Feature
	- Began mocking up card UI
	- Created DailyCheckin model

## [Fri 20.06.25]
**Log:**
1. Play around with grid styling on DailyCheckin card
2. Cleaning up forms & adding basic frontend validation
	- Use form-group styling to clean up form layout
	- Add user-valid/invalid
	- Add HTML5 validation with required, pattern, min/max
	- Add tooltips to some form fields
3. Tests
	- Remove a couple dumb tests
	- Add fixture for sample_product
	- Add test for __str__ for Product/Transaction
	
## [Sat 21.06.25]
**Log:**
1. Getting Started with Data Visualization (Plan: Start with Plotly, check out D3.js later)
	- Install plotly & plotly express: pip install plotly , and pip install plotly[express]
	- Install pandas: pip install pandas

## [Sun 22.06.25]
**Log:**
1. Code Quality, UI/UX, & Architecture Improvements
	- Added generalized PATCH route (remove redundant update_task & delete_task)
	- Extended double-click inline cell editing to habit titles
	- Moved styling to form-group CSS classes for consistency
	- Associated labels with inputs for better accessibility
	- Transitioned from inline event handlers to addEventListener for cell editing
	- Moved table cell edit functions to dedicated tables.js file
	- DailyIntention: Replaced clunky submit button with blur/enter-to-save pattern
	- Updated all other fetch() requests to more modern async/await pattern
	- Improved error handling in some routes & implemented better JSON responses for success/error
	- Fixed critical issue in seed_db where I didn't commit deletes before proceeding (oops!)
	- Add seed data for DailyMetrics - weight, steps, movement
	- Make metric inputs & chart containers stack vertically on smaller screens
2. Added Metrics module
	- Added blueprint, basic route, navbar links, etc.
	- Added utility function to make bar graphs & added a couple basic graphs

## [Mon 23.06.25]

**Log:**
1. Event Delegation Refactoring
   - Converted from individual event listeners to centralized event delegation
   - Generally cleaned up listeners
2. Input editing UX
   - Made input field size to accommodate text
   - Fallback to original text if input is empty
3. Organization / Documentation
   - Added JSDocs to several functions
   - Extracted drawSun magic numbers into SUN_CONFIG constant
   - Standardized backend JSON responses a bit
   - Cleaned up some variable naming
4. Data Export via CSV
   - Key components:
     1. Python csv handling (csv module or pandas)
     2. Flask file download mechanics (send_file, proper headers)
     3. Data formatting & cleaning before export
     4. Frontend polish for button/options
   - Getting started with DictWriter/DictReader
5. Adding Price per 100g
   - Added function basics to groceries/utils.py (& type annotated)
   - Made basic test to check
   - Added column for this in Transaction table
6. Metrics tweak
   - Added aspect-ratio CSS to make graphs match height
7. Routes & REST Improvements
   - Made route structure more RESTful
   - Updated completions/delete route to accept arbitrary dates (was hardcoded to /today)
8. Time Entry Integration
   - Wired up route for adding time entries
9. Schema & Repo Layer Changes
   - Product model: Added deleted_at for soft deletion
   - Habit model: Added cascade delete on completions to prevent orphan records
   - Repo functions updated to exclude soft-deleted products (deleted_at.is_(None))
10. DB Connection Cleanup
    - Added database_connection() context manager in database.py
    - Refactored multiple routes to use this, with try/except for route-level error handling
11. Repo Fixes
    - Updated add_product() repo function to support newly added fields
